<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SquinaXV - Pedidos</title>
  <link rel="icon" href="img/stg.ico" type="image/x-icon">
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>

  <header class="header">
    <div class="container">
      <h1 class="logo">
        <img src="img/stg.jpeg" alt="Del√≠cias Gourmet" class="logo-image">
        SquinaXV
      </h1>
      <div class="menu-hamburguer">‚ò∞</div>
      <nav class="nav">
        <a href="login_index.php" class="nav-link active">Login</a>
        <a href="#ofertas" class="nav-link">Ofertas</a>
        <a href="#contato" class="nav-link">Contato</a>
      </nav>
    </div>
  </header>

  <div class="search-bar">
    <div class="container">
      <div class="search-container">
        <i class="fas fa-search"></i>
        <input type="text" id="searchInput" placeholder="Pesquisar Del√≠cias...">
      </div>
    </div>
  </div>

  <main class="container">
    <div class="menu-grid" id="menuContainer">
      <!-- produtos via index.js -->
    </div>
  </main>

  <!-- Backdrop para mobile -->
  <div class="cart-backdrop"></div>

  <!-- Bot√£o flutuante do carrinho -->
  <div class="cart-floating">
    <button class="cart-button">
      <i class="fas fa-shopping-cart"></i>
      <span class="cart-count">0</span>
    </button>
  </div>

  <!-- Carrinho lateral -->
  <aside class="cart-sidebar">
    <div class="cart-header">
      <h2>Seu Pedido</h2>
      <button class="close-cart" aria-label="Fechar carrinho">&times;</button>
    </div>

    <ul class="cart-items" id="cartItems"></ul>

    <div class="cart-total">
      Total a pagar: R$<span id="cartTotal">0.00</span>
    </div>

    <!-- Endere√ßo -->
    <div class="frete-container">
      <h3>Informe seu Endere√ßo</h3>
      <form id="enderecoForm">
        <label for="endereco">Endere√ßo Completo:</label>
        <input type="text" id="endereco" name="endereco" placeholder="Rua, n√∫mero, bairro, cidade, estado" required>
        <button type="submit">Confirmar Endere√ßo</button>
      </form>
      <div id="enderecoResultado"></div>
    </div>

    <button id="checkoutButton" class="checkout-button">Finalizar Compra</button>
  </aside>

  <!-- Modal de produto -->
  <div id="productModal" class="modal hidden" aria-hidden="true">
    <div class="modal-backdrop" onclick="closeProductModal()"></div>
    <div class="modal-card" role="dialog" aria-modal="true">
      <header class="modal-header">
        <h3 id="modalTitle">Produto</h3>
        <button class="modal-close" onclick="closeProductModal()" aria-label="Fechar">√ó</button>
      </header>

      <form id="modalForm" class="modal-body">
        <div class="modal-row">
          <div class="modal-price">R$ <span id="modalPrice">0.00</span></div>
        </div>

        <div class="modal-row">
          <label class="modal-label">Tamanho</label>
          <div id="sizesContainer" class="options-list"></div>
        </div>

        <div class="modal-row">
          <label class="modal-label">Adicionais</label>
          <div id="adicionaisContainer" class="options-list"></div>
        </div>

        <div class="modal-row">
          <label class="modal-label">Quantidade</label>
          <input type="number" id="modalQty" min="1" value="1">
        </div>

        <div class="modal-actions">
          <button type="submit" class="btn primary">Adicionar ao pedido</button>
          <button type="button" class="btn link" onclick="closeProductModal()">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Scripts principais -->
   <script src="js/index.js"></script>
  <script src="js/product-options.js"></script>
  

  <!-- Script de checkout visitante -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
  const menuHamburguer = document.querySelector(".menu-hamburguer");
  const nav = document.querySelector(".nav");

  if (menuHamburguer && nav) {
    menuHamburguer.addEventListener("click", (e) => {
      e.stopPropagation();
      nav.classList.toggle("active");
      menuHamburguer.classList.toggle("open");
    });

    nav.addEventListener("click", (e) => {
      if (e.target.classList.contains("nav-link")) {
        nav.classList.remove("active");
        menuHamburguer.classList.remove("open");
      }
    });

    document.addEventListener("click", (e) => {
      if (!nav.contains(e.target) && !menuHamburguer.contains(e.target)) {
        nav.classList.remove("active");
        menuHamburguer.classList.remove("open");
      }
    });
  }
});
  document.addEventListener('DOMContentLoaded', () => {
    console.log("Checkout visitante pronto.");

    // üî∏ Frete fixo (sem API)
    document.getElementById('enderecoForm').addEventListener('submit', e => {
      e.preventDefault();
      const endereco = document.getElementById('endereco').value.trim();
      if (!endereco) return alert('Digite um endere√ßo v√°lido.');
      const frete = 5.00;
      document.getElementById('enderecoResultado').innerHTML =
        `<p>Endere√ßo: ${endereco}</p><p>Frete fixo: R$ ${frete.toFixed(2)}</p>`;
      localStorage.setItem('endereco', endereco);
      localStorage.setItem('frete', frete);
    });

    // üî∏ Fun√ß√£o pra salvar o pedido visitante
    async function saveGuestCart() {
      try {
        const cartData = localStorage.getItem('cart');
        const cartItems = cartData ? JSON.parse(cartData) : [];

        console.log("Itens do carrinho visitante:", cartItems);

        if (!cartItems.length) {
          alert("Seu carrinho est√° vazio!");
          return false;
        }

        const frete = Number(localStorage.getItem('frete') || 5.00);
        const endereco = localStorage.getItem('endereco') || '';

        const total = cartItems.reduce((acc, item) => {
          const preco = Number(item.basePrice || item.price || 0);
          const qtd = Number(item.quantity || 1);
          const somaAdicionais = Array.isArray(item.adicionais)
            ? item.adicionais.reduce((s, a) => s + Number(a.price || 0), 0)
            : 0;
          return acc + (preco + somaAdicionais) * qtd;
        }, 0) + frete;

        const pedido = { produtos: cartItems, frete, endereco, total };
        localStorage.setItem('pedidoCheckout', JSON.stringify(pedido));

        console.log("‚úÖ Pedido visitante salvo:", pedido);
        return true;
      } catch (err) {
        console.error("Erro ao salvar pedido visitante:", err);
        return false;
      }
    }

    // üî∏ Quando clicar em "Finalizar Compra"
    document.getElementById('checkoutButton').addEventListener('click', async e => {
      e.preventDefault();
      const ok = await saveGuestCart();
      if (ok) window.location.href = 'checkout.php';
    });
  });
  </script>

</body>
</html>
