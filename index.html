<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SquinaXV - Pedidos</title>
  <link rel="icon" href="img/stg.ico" type="image/x-icon">
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/antijingoist/opendyslexic/opendyslexic.css">
</head>


<body>

  <div id="acess-widget-button">
    ‚öôÔ∏è
</div>

<div id="acess-panel">
    <h3>Acessibilidade</h3>

    <button onclick="fonteMenor()">A-</button>
    <button onclick="fonteNormal()">A</button>
    <button onclick="fonteMaior()">A+</button>
    <hr>

    <button onclick="alternarContraste()">Contraste</button>
    <button id="btnDys">Disl√©xico</button>
    <button id="btnDaltonismo">Daltonismo</button>
    <hr>
</div>

  <header class="header">
    <div class="container">
      <h1 class="logo">
        <img src="img/stg.jpeg" alt="Del√≠cias Gourmet" class="logo-image">
        SquinaXV
      </h1>
      <div class="menu-hamburguer">‚ò∞</div>
      <nav class="nav">
        <div class="menu-tabs" id="menuTabs" style="margin-left:12px;">
          <button id="themeToggle" class="theme-toggle">
            <i class="fas fa-moon"></i>
          </button>
          <a href="login_index.php" class="nav-link active">Login</a>
          <a href="https://wa.me/+5519982619876" class="nav-link">Contato</a>
          <button class="tab active" data-filter="all">Todos</button>
          <button class="tab" data-filter="drinks">Bebidas</button>
        </div>
      </nav>
    </div>
  </header>

  <div class="search-bar">
    <div class="container">
      <div class="search-container">
        <i class="fas fa-search"></i>
        <input type="text" id="searchInput" placeholder="Pesquisar Del√≠cias...">
      </div>
    </div>
  </div>

  <main class="container">
    <div class="menu-grid" id="menuContainer">
      <!-- produtos via index.js -->
    </div>
  </main>

  <!-- Backdrop para mobile -->
  <div class="cart-backdrop"></div>

  <!-- Bot√£o flutuante do carrinho -->
  <div class="cart-floating">
    <button class="cart-button">
      <i class="fas fa-shopping-cart"></i>
      <span class="cart-count">0</span>
    </button>
  </div>

  <!-- Carrinho lateral -->
  <aside class="cart-sidebar">
    <div class="cart-header">
      <h2>Seu Pedido</h2>
      <button class="close-cart" aria-label="Fechar carrinho">&times;</button>
    </div>

    <ul class="cart-items" id="cartItems"></ul>

    <div class="cart-total">
      Total a pagar: R$<span id="cartTotal">0.00</span>
    </div>

    <!-- Endere√ßo -->
    <div class="frete-container">
      <h3>Informe seu Endere√ßo</h3>
      <form id="enderecoForm">
        <label for="endereco">Endere√ßo Completo:</label>
        <input type="text" id="endereco" name="endereco" placeholder="Rua, n√∫mero, bairro, cidade, estado" required>
        <button type="submit">Confirmar Endere√ßo</button>
      </form>
      <div id="enderecoResultado"></div>
    </div>

    <button id="checkoutButton" class="checkout-button">Finalizar Compra</button>
  </aside>

  <!-- Modal de produto -->
  <div id="productModal" class="modal hidden" aria-hidden="true">
    <div class="modal-backdrop" onclick="closeProductModal()"></div>
    <div class="modal-card" role="dialog" aria-modal="true">
      <header class="modal-header">
        <h3 id="modalTitle">Produto</h3>
        <button class="modal-close" onclick="closeProductModal()" aria-label="Fechar">√ó</button>
      </header>

      <form id="modalForm" class="modal-body">
        <div class="modal-row">
          <div class="modal-price">R$ <span id="modalPrice">0.00</span></div>
        </div>

        <div class="modal-row">
          <label class="modal-label">Tamanho</label>
          <div id="sizesContainer" class="options-list"></div>
        </div>

        <div class="modal-row">
          <label class="modal-label">Adicionais</label>
          <div id="adicionaisContainer" class="options-list"></div>
        </div>

        <div class="modal-row">
          <label class="modal-label">Quantidade</label>
          <input type="number" id="modalQty" min="1" value="1">
        </div>

        <div class="modal-actions">
          <button type="submit" class="btn primary">Adicionar ao pedido</button>
          <button type="button" class="btn link" onclick="closeProductModal()">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Scripts principais -->
  <script src="js/index.js?v=4.1.3"></script>
  <script src="js/product-options.js?v=4.1.3"></script>
  <script src="js/ui_control.js?v=4.1.3"></script>


  <!-- Script de checkout visitante -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const menuHamburguer = document.querySelector(".menu-hamburguer");
      const nav = document.querySelector(".nav");

      if (menuHamburguer && nav) {
        menuHamburguer.addEventListener("click", (e) => {
          e.stopPropagation();
          nav.classList.toggle("active");
          menuHamburguer.classList.toggle("open");
        });

        nav.addEventListener("click", (e) => {
          if (e.target.classList.contains("nav-link")) {
            nav.classList.remove("active");
            menuHamburguer.classList.remove("open");
          }
        });

        document.addEventListener("click", (e) => {
          if (!nav.contains(e.target) && !menuHamburguer.contains(e.target)) {
            nav.classList.remove("active");
            menuHamburguer.classList.remove("open");
          }
        });
      }
    });
    document.addEventListener('DOMContentLoaded', () => {
      console.log("Checkout visitante pronto.");

      // üî∏ Frete fixo (sem API)
      document.getElementById('enderecoForm').addEventListener('submit', e => {
        e.preventDefault();
        const endereco = document.getElementById('endereco').value.trim();
        if (!endereco) return alert('Digite um endere√ßo v√°lido.');
        const frete = 5.00;
        document.getElementById('enderecoResultado').innerHTML =
          `<p>Endere√ßo: ${endereco}</p><p>Frete fixo: R$ ${frete.toFixed(2)}</p>`;
        localStorage.setItem('endereco', endereco);
        localStorage.setItem('frete', frete);
      });

      // üî∏ Fun√ß√£o pra salvar o pedido visitante
      async function saveGuestCart() {
        try {
          const cartData = localStorage.getItem('cart');
          const cartItems = cartData ? JSON.parse(cartData) : [];

          console.log("Itens do carrinho visitante:", cartItems);

          if (!cartItems.length) {
            alert("Seu carrinho est√° vazio!");
            return false;
          }

          const frete = Number(localStorage.getItem('frete') || 5.00);
          const endereco = localStorage.getItem('endereco') || '';

          const total = cartItems.reduce((acc, item) => {
            const preco = Number(item.basePrice || item.price || 0);
            const qtd = Number(item.quantity || 1);
            const somaAdicionais = Array.isArray(item.adicionais)
              ? item.adicionais.reduce((s, a) => s + Number(a.price || 0), 0)
              : 0;
            return acc + (preco + somaAdicionais) * qtd;
          }, 0) + frete;

          const pedido = { produtos: cartItems, frete, endereco, total };
          localStorage.setItem('pedidoCheckout', JSON.stringify(pedido));

          console.log("‚úÖ Pedido visitante salvo:", pedido);
          return true;
        } catch (err) {
          console.error("Erro ao salvar pedido visitante:", err);
          return false;
        }
      }

      // üî∏ Quando clicar em "Finalizar Compra"
      document.getElementById('checkoutButton').addEventListener('click', async e => {
        e.preventDefault();
        const ok = await saveGuestCart();
        if (ok) window.location.href = 'checkout.php';
      });
    });
  </script>
<!-- VLibras Widget -->
<div vw class="enabled">
  <div vw-access-button class="active"></div>
  <div vw-plugin-wrapper>
    <div class="vw-plugin-top-wrapper"></div>
  </div>
</div>

 </script>
<!-- VLibras Widget -->
<div vw class="enabled">
  <div vw-access-button class="active"></div>
  <div vw-plugin-wrapper>
    <div class="vw-plugin-top-wrapper"></div>
  </div>
</div>
<div id="reading-mask"></div>
<script src="https://vlibras.gov.br/app/vlibras-plugin.js"></script>
<script>
  new window.VLibras.Widget('https://vlibras.gov.br/app');
</script>
<script>
// Abrir painel
const btnWidget = document.getElementById("acess-widget-button");
const painel = document.getElementById("acess-panel");

btnWidget.addEventListener("click", () => {
    painel.classList.toggle("open");
});

// Fonte
let tamanhoBase = 100;
function aplicarFonte() {
  document.documentElement.style.fontSize = tamanhoBase + "%";
  localStorage.setItem("tamanhoFonte", tamanhoBase);
}
function fonteMenor() { if (tamanhoBase > 70) { tamanhoBase -= 10; aplicarFonte(); } }
function fonteNormal() { tamanhoBase = 100; aplicarFonte(); }
function fonteMaior() { if (tamanhoBase < 160) { tamanhoBase += 10; aplicarFonte(); } }

// Contraste
function alternarContraste() {
  document.body.classList.toggle("alto-contraste");
  localStorage.setItem("altoContraste", document.body.classList.contains("alto-contraste") ? "1" : "0");
}

// Dyslexic
document.getElementById("btnDys").onclick = () => {
    document.body.classList.toggle("opendyslexic");
    localStorage.setItem("opendyslexic", document.body.classList.contains("opendyslexic") ? "1" : "0");
};

// Daltonismo
document.getElementById("btnDaltonismo").onclick = () => {
    document.body.classList.toggle("daltonismo");
    localStorage.setItem("daltonismo", document.body.classList.contains("daltonismo") ? "1" : "0");
};

// M√°scara leitura
document.getElementById("btnMascara").onclick = () => {
    document.body.classList.toggle("mascara-leitura");
    localStorage.setItem("mascaraLeitura", document.body.classList.contains("mascara-leitura") ? "1" : "0");
};
document.addEventListener("mousemove", function(e) {
  const mask = document.getElementById("reading-mask");
  if (!mask || !document.body.classList.contains("mascara-leitura")) return;
  mask.style.top = e.clientY - 60 + "px";
});

// Cursor
document.getElementById("btnCursor").onclick = () => {
    document.body.classList.toggle("cursor-grande");
    localStorage.setItem("cursorGrande", document.body.classList.contains("cursor-grande") ? "1" : "0");
};

// Modo leitura
document.getElementById("btnLeitura").onclick = () => {
    document.body.classList.toggle("modo-leitura");
    localStorage.setItem("modoLeitura", document.body.classList.contains("modo-leitura") ? "1" : "0");
};

// Carregar prefer√™ncias
(function() {
  let fs = localStorage.getItem("tamanhoFonte"); 
  if (fs) { tamanhoBase = parseInt(fs); aplicarFonte(); }

  if (localStorage.getItem("altoContraste")==="1") document.body.classList.add("alto-contraste");
  if (localStorage.getItem("opendyslexic")==="1") document.body.classList.add("opendyslexic");
  if (localStorage.getItem("daltonismo")==="1") document.body.classList.add("daltonismo");
})();
</script>
</body>

</html>